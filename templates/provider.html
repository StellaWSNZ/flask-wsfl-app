{% extends "header.html" %}
{% block title %}Provider Reports{% endblock %}
{% block content %}

<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3">
      <div class="card">
        <div class="card-header">Report Options</div>
        <div class="card-body">
          <form action="/provider" method="POST" class="row g-3">
            <div class="col-12">
              <label for="report_type" class="form-label">Report Type</label>
              <select
                name="report_type"
                id="report_type"
                class="form-select"
                onchange="toggleReportFields()"
                required
              >
                <option value="Provider" {% if selected_report_type == "Provider" %}selected{% endif %}>Provider Report</option>
                <option value="Competency" {% if selected_report_type == "Competency" %}selected{% endif %}>Competency Report</option>
              </select>
            </div>

            {% if user_role == 'ADM' %}
            <div class="col-12" id="provider_section">
              <label for="provider" class="form-label">Provider</label>
              <select name="provider" id="provider" class="form-select">
                {% for name in providers %}
                  <option value="{{ name }}" {% if name == selected_provider %}selected{% endif %}>{{ name }}</option>
                {% endfor %}
              </select>
            </div>
            {% endif %}

            <div class="col-6">
              <label for="term" class="form-label">Term</label>
              <select name="term" id="term" class="form-select" required>
                <option value="1" {% if selected_term == 1 %}selected{% endif %}>1</option>
                <option value="2" {% if selected_term == 2 %}selected{% endif %}>2</option>
                <option value="3" {% if selected_term == 3 %}selected{% endif %}>3</option>
                <option value="4" {% if selected_term == 4 %}selected{% endif %}>4</option>
              </select>
            </div>

            <div class="col-6">
              <label for="year" class="form-label">Year</label>
              <select name="year" id="year" class="form-select" required>
                <option value="2025" {% if selected_year == 2025 %}selected{% endif %}>2025</option>
                <option value="2024" {% if selected_year == 2024 %}selected{% endif %}>2024</option>
                <option value="2023" {% if selected_year == 2023 %}selected{% endif %}>2023</option>
              </select>
            </div>

            <div class="col-12" id="competency_section" style="display: none">
              <label for="competency" class="form-label">Competency</label>
              <select name="competency" id="competency" class="form-select">
                {% for comp in competencies %}
                  <option value="{{ comp }}" {% if comp == selected_competency %}selected{% endif %}>{{ comp }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="col-12">
              <button type="submit" class="btn btn-primary w-100">
                View Report
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Report Content -->
    <div class="col-md-9">
      <div class="card">
        <div class="card-header">Report Output</div>
        <div class="card-body text-center">
          {% if img_data %}
          <img
            src="data:image/png;base64,{{ img_data }}"
            class="img-fluid"
            alt="Report Image"
          />
          <div class="mt-3">
            <a
              href="{{ url_for('provider_download_pdf') }}"
              class="btn btn-outline-secondary"
              >Download PDF</a
            >
            <a
              href="{{ url_for('provider_download_png') }}"
              class="btn btn-outline-secondary ms-2"
              >Download PNG</a
            >
          </div>
          {% else %}
          <p>Select a report type and options to view output.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function toggleReportFields() {
    const type = document.getElementById('report_type').value;
    document.getElementById('competency_section').style.display = type === 'Competency' ? 'block' : 'none';
    {% if user_role == 'ADM' %}
      document.getElementById('provider_section').style.display = type === 'Provider' ? 'block' : 'none';
    {% endif %}
  }
  window.onload = toggleReportFields;
</script>

{% endblock %}
