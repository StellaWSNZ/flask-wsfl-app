{% extends "header.html" %} {% block title %}Instructions{% endblock %} {% block
content %}

<div class="container mt-5" style="max-width: 70%">
  <h2 class="mb-4 text-center text-primary">
    Working Instructions - {{ role_label }}
  </h2>

  {% if items|length == 0 %}
  <div class="alert alert-warning text-center" role="alert">
    No instructions found for <strong>{{ role_label }}</strong>.<br />
    Place files under <code>static/instructions/{{ role_code }}/</code> (e.g.
    <em>“Staff Maintenance.mp4”</em> and <em>“Staff Maintenance.pdf”</em>).
  </div>
  {% else %}
  <div class="accordion" id="instAccordion">
    {% for item in items %} {% set is_open = loop.first %} {% set base = 'acc-'
    ~ loop.index %} {% set header_id = base ~ '-hdr' %} {% set panel_id = base ~
    '-panel' %}

    <div class="accordion-item border-2" style="border-color: #1a427d">
      <h2 class="accordion-header" id="{{ header_id }}">
        <button
          class="accordion-button {% if not is_open %}collapsed{% endif %}"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#{{ panel_id }}"
          aria-expanded="{{ 'true' if is_open else 'false' }}"
          aria-controls="{{ panel_id }}"
        >
          {{ item.title }}
        </button>
      </h2>

      <div
        id="{{ panel_id }}"
        class="accordion-collapse collapse {% if is_open %}show{% endif %}"
        aria-labelledby="{{ header_id }}"
        data-bs-parent="#instAccordion"
        role="region"
      >
        <div class="accordion-body">
          {% if item.video_url %}
          <div class="ratio ratio-16x9 mb-3">
            <video
              controls
              playsinline
              preload="metadata"
              src="{{ item.video_url }}"
              style="border-radius: 8px; width: 100%; height: 100%"
            >
              Your browser does not support the video tag.
            </video>
          </div>

          <!-- Fallback: if video player fails, user can still open it -->
          <div class="mb-3">
            <a
              class="btn btn-outline-primary btn-sm"
              href="{{ item.video_url }}"
              target="_blank"
              rel="noopener"
            >
              Open video in new tab
            </a>
          </div>
          {% else %}
          <p class="text-muted">No video available for this topic.</p>
          {% endif %}

          <div class="d-flex gap-2">
            {% if item.pdf_url %}
            <a class="btn btn-primary" href="{{ item.pdf_download_url }}">
              Download PDF
            </a>

            <a
              class="btn btn-outline-primary"
              href="{{ item.pdf_url }}"
              target="_blank"
              rel="noopener"
            >
              Open PDF
            </a>
            {% else %}
            <span class="badge bg-secondary">No PDF</span>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% endif %}
</div>

<style>
  @media (max-width: 767.98px) {
    .container {
      max-width: 95% !important; /* nearly full-width on phones */
      padding-left: 0.75rem !important;
      padding-right: 0.75rem !important;
    }
    .accordion-button {
      font-size: 1rem;
      padding: 0.75rem 1rem;
    }
    .accordion-body {
      padding: 0.75rem;
    }
    video {
      border-radius: 6px;
    }
    .btn {
      padding: 0.45rem 0.75rem;
      font-size: 0.9rem;
    }
  }
</style>

{% endblock %}
