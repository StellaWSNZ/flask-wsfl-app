{% extends "header.html" %}
{% block title %}View My School's Classes{% endblock %}

{% block content %}
<style>
  /* Shared look */
  .class-card {
    border: 1px solid #e9ecef;
    border-radius: 0.75rem;
    background: #fff;
    box-shadow: 0 1px 2px rgba(0,0,0,.04);
  }
  .class-card .label {
    color: #6c757d;
    font-size: .9rem;
  }
  .badge-soft {
    background: #0d6efd1a;
    color: #0d6efd;
  }
  .badge-soft-secondary {
    background: #6c757d1a;
    color: #6c757d;
  }
  .btn-wrap > * { min-width: 180px; }
  @media (max-width: 575.98px) {
    .btn-wrap { flex-direction: column; gap: .5rem; }
    .btn-wrap > * { width: 100%; min-width: 0; }
  }

  /* Responsive visibility rules */
  .class-table { display: none; }      /* hidden on mobile */
  .class-cards { display: block; }     /* shown on mobile */

  @media (min-width: 768px) {
    .class-table { display: table; }   /* shown on desktop */
    .class-cards { display: none; }    /* hidden on desktop */
  }
</style>

<h3 class="text-primary mb-4 text-center">Filter Classes</h3>

<form method="POST">
  <div class="container">
    <div class="row justify-content-center align-items-end g-3">
      <!-- Term -->
      <div class="col-md-2">
        <label for="term" class="form-label">Term</label>
        <select name="term" id="term" class="form-select" required>
          <option value="" disabled {% if not selected_term %}selected{% endif %}>Select term</option>
          {% for t in [1, 2, 3, 4] %}
            <option value="{{ t }}" {% if selected_term|string == t|string %}selected{% endif %}>{{ t }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Year -->
      <div class="col-md-2">
        <label for="calendaryear" class="form-label">Year</label>
        <select name="calendaryear" id="calendaryear" class="form-select" required>
          <option value="" disabled {% if not selected_year %}selected{% endif %}>Select year</option>
          {% for y in [2023, 2024, 2025] %}
            <option value="{{ y }}" {% if selected_year|string == y|string %}selected{% endif %}>{{ y }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Submit -->
      <div class="col-md-auto">
        <button type="submit" class="btn btn-primary w-100">Find Classes</button>
      </div>
    </div>
  </div>
</form>

{% if classes %}
<div class="container mt-4">
  <h4 class="text-center mb-3">Classes at {{desc}}</h4>

  <!-- MOBILE CARDS -->
  <div class="class-cards">
    <div class="row g-3 justify-content-center">
      {% for cls in classes %}
      <div class="card shadow-sm mb-3 border-0">
        <div class="card-body">
          <h6 class="card-title mb-2 text-primary fw-semibold">{{ cls.ClassName }}</h6>
          <p class="mb-1"><span class="fw-semibold text-muted">Teacher:</span> {{ cls.TeacherName }}</p>
          <p class="mb-3"><span class="fw-semibold text-muted">Year Levels:</span> {{ cls.YearLevels }}</p>

          <div class="d-flex flex-wrap gap-2 mt-2">
            <a class="btn btn-outline-secondary btn-sm"
              href="{{ url_for('class_bp.view_class', class_id=cls.ClassID, term=request.form['term'], year=request.form['calendaryear'], filter='all') }}">
              All Competencies
            </a>
            <a class="btn btn-outline-primary btn-sm"
              href="{{ url_for('class_bp.view_class', class_id=cls.ClassID, term=request.form['term'], year=request.form['calendaryear'], filter='water') }}">
              Water-Based
            </a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- DESKTOP TABLE -->
  <div class="class-table table-responsive mt-3">
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>Class Name</th>
          <th>Teacher</th>
          <th>Year Levels</th>
          <th class="text-center">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for cls in classes %}
        <tr>
          <td class="fw-semibold text-primary">{{ cls.ClassName }}</td>
          <td>{{ cls.TeacherName }}</td>
          <td>{{ cls.YearLevels }}</td>
          <td class="text-center">
            <a class="btn btn-outline-secondary btn-sm me-1"
              href="{{ url_for('class_bp.view_class', class_id=cls.ClassID, term=request.form['term'], year=request.form['calendaryear'], filter='all') }}">
              All
            </a>
            <a class="btn btn-outline-primary btn-sm"
              href="{{ url_for('class_bp.view_class', class_id=cls.ClassID, term=request.form['term'], year=request.form['calendaryear'], filter='water') }}">
              Water-Based
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endif %}

{% if suggestions and not classes %}
<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="alert alert-warning text-center">
        <strong>No classes found.</strong><br />
        Your school has classes from:
        <ul class="mb-0 text-start">
          {% for s in suggestions %}
            <li>{{ s }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}
