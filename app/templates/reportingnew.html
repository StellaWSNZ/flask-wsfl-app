{% extends "header.html" %}
{% block title %}New Reporting{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="text-center text-primary mb-4">Funder Reporting Dashboard</h2>

  <form method="POST">
    <div class="row mb-3">
      <div class="col-md-3">
        <label for="year" class="form-label">Year</label>
        <select name="year" class="form-select">
          <option value="2024" {% if selected_year == 2024 %}selected{% endif %}>2024</option>
          <option value="2025" {% if selected_year == 2025 %}selected{% endif %}>2025</option>
        </select>
      </div>

      <div class="col-md-3">
        <label for="term" class="form-label">Term</label>
        <select name="term" class="form-select">
          <option value="2" {% if selected_term == 2 %}selected{% endif %}>2</option>
          <option value="3" {% if selected_term == 3 %}selected{% endif %}>3</option>
        </select>
      </div>

      {% if role == "ADM" %}
      <div class="col-md-6">
        <label for="selected_funder" class="form-label">Select Funder</label>
        <select name="selected_funder" class="form-select">
          {% for f in funder_dropdown %}
          <option value="{{ f }}" {% if f == funder_name %}selected{% endif %}>{{ f }}</option>
          {% endfor %}
        </select>
      </div>
      {% endif %}
    </div>

    <div class="row mb-4">
      <div class="col-md-12">
        <label for="report_option" class="form-label">Select Report Type</label>
        <select name="report_option" class="form-select">
          <option value="national_vs_funder">National Rate YTD vs Funder Rate YTD + Funder Target</option>
          <option value="provider_comparison">Provider Rate YTD + Funder Rate YTD + Best Funder Result</option>
          <option value="best_funder">Funder Rate YTD vs Best Funder Rate</option>
        </select>
      </div>
    </div>

    <div class="text-center mb-4">
      <button type="submit" class="btn btn-primary px-4">Generate Report</button>
    </div>
  </form>

  {% if results and results[0] %}
  <h4 class="text-center text-success mt-5">Results for {{ funder_name }}</h4>
  <div class="table-responsive mt-3">
    <table class="table table-bordered table-striped">
      <thead class="table-dark">
        <tr>
          {% for col in results[0].keys() %}
          <th>{{ col }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for row in results %}
        <tr>
          {% for cell in row.values() %}
          <td>{{ cell }}</td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% elif selected_year %}
  <div class="alert alert-warning text-center mt-4">
    No results found for the selected options.
  </div>
  {% endif %}
</div>
{% endblock %}
