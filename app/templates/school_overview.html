{% extends "header.html" %}
{% block title %}School Overview{% endblock %}

{% block content %}
<style>
  thead.custom-header th {
    background-color: #004080 !important;
    color: white !important;
    border-color: #004080 !important;
    text-align: center;
  }
  .inline-filter .form-select {
    min-width: 140px;
  }
</style>

<div class="container mt-5" style="max-width: 95%;">
  <h2 class="text-center text-primary mb-4">{{ title }}</h2>

  <div class="row g-4">
    <!-- Left: Class Summary -->
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Class Summary</h5>
        </div>
        <div class="card-body">
          {% if available_years and available_terms %}
          <!-- Dropdowns INSIDE the card body, above the table -->
          <form method="POST" class="inline-filter row g-2 align-items-end mb-3">
            <div class="col-md-5">
              <label for="term" class="form-label mb-1">Term</label>
              <select name="term" id="term" class="form-select" onchange="this.form.submit()">
                {% for t in available_terms %}
                  <option value="{{ t }}" {% if selected_term|int == t %}selected{% endif %}>Term {{ t }}</option>
                {% endfor %}
              </select>
            </div>
            <div class="col-md-5">
              <label for="year" class="form-label mb-1">Calendar Year</label>
              <select name="year" id="year" class="form-select" onchange="this.form.submit()">
                {% for y in available_years %}
                  <option value="{{ y }}" {% if selected_year|int == y %}selected{% endif %}>{{ y }}</option>
                {% endfor %}
              </select>
            </div>
            <noscript class="col-md-2 d-flex">
              <button type="submit" class="btn btn-primary w-100">Apply</button>
            </noscript>
          </form>
          {% endif %}

          {% if classes %}
  <!-- Desktop / tablet -->
  <div class="d-none d-sm-block">
    <div class="table-responsive">
      <table class="table table-bordered text-center align-middle">
        <thead class="custom-header">
          <tr>
            <th>Class Name</th>
            <th>Teacher</th>
            <th>Class Size</th>
            <th>Year Levels</th>
          </tr>
        </thead>
        <tbody>
          {% for row in classes %}
          <tr>
            <td>{{ row["Class Name"] }}</td>
            <td>{{ row["Teacher"] }}</td>
            <td>{{ row["ClassSize"] }}</td>
            <td>{{ row["DistinctYearLevels"] }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Phone cards -->
  {% set title_key = 'Class Name' %}
  <div class="d-sm-none" id="classCards">
    {% for row in classes %}
      <div class="card shadow-sm mb-2">
        <div class="card-body">
          <strong class="d-block mb-2">{{ row[title_key] }}</strong>
          <div class="mobile-grid">
            <div class="mobile-grid-row">
              <div class="mobile-grid-label">Teacher</div>
              <div class="mobile-grid-value">{{ row["Teacher"] }}</div>
            </div>
            <div class="mobile-grid-row">
              <div class="mobile-grid-label">Class Size</div>
              <div class="mobile-grid-value">{{ row["ClassSize"] }}</div>
            </div>
            <div class="mobile-grid-row">
              <div class="mobile-grid-label">Year Levels</div>
              <div class="mobile-grid-value">{{ row["DistinctYearLevels"] }}</div>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-warning mb-0">
    No class data found for Term {{ selected_term }} in {{ selected_year }}.
  </div>
{% endif %}
        </div>
      </div>
    </div>

    <!-- Right: School Staff -->
    <!-- Right: School Staff -->
<div class="col-md-6">
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">School Staff</h5>
    </div>
    <div class="card-body">
      {% if staff %}

        {# Desktop / tablet table #}
        <div class="d-none d-sm-block">
          <div class="table-responsive">
            <table class="table table-bordered text-center align-middle">
              <thead class="custom-header">
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Admin</th>
                  <th>Active</th>
                </tr>
              </thead>
              <tbody>
                {% for person in staff %}
                <tr>
                  <td>{{ person["FirstName"] }} {{ person["Surname"] }}</td>
                  <td>
                    {% set email = person["Email"] %}
                    {% if email %}
                      <a href="mailto:{% raw %}{{{% endraw %} email {% raw %}}}{% endraw %}">{{ email }}</a>
                    {% else %}
                      —
                    {% endif %}
                  </td>
                  <td>
                    {% if person["Access"] == "Administrator privileges" %}
                      <span class="badge bg-success">Yes</span>
                    {% else %}
                      <span class="badge bg-secondary">No</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if person["Status"] == "Active" %}
                      <span class="badge bg-success">Active</span>
                    {% else %}
                      <span class="badge bg-danger">Inactive</span>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>

        {# Phone cards #}
        <div class="d-sm-none" id="staffCards">
          {% for person in staff %}
            {% set full_name = (person["FirstName"] ~ " " ~ person["Surname"]).strip() %}
            {% set email = person["Email"] %}
            {% set is_admin = (person["Access"] == "Administrator privileges") %}
            {% set is_active = (person["Status"] == "Active") %}

            <div class="card shadow-sm mb-2">
              <div class="card-body">
                <strong class="d-block mb-1">{{ full_name }}</strong>

                <div class="mobile-grid">
                  <div class="mobile-grid-row">
                    <div class="mobile-grid-label">Email</div>
                    <div class="mobile-grid-value">
                      {% if email %}
                        <a href="mailto:{% raw %}{{{% endraw %} email {% raw %}}}{% endraw %}">{{ email }}</a>
                      {% else %}
                        <span class="text-muted">—</span>
                      {% endif %}
                    </div>
                  </div>

                  <div class="mobile-grid-row">
                    <div class="mobile-grid-label">Admin</div>
                    <div class="mobile-grid-value">
                      {% if is_admin %}
                        <span class="badge bg-success badge-tap">Yes</span>
                      {% else %}
                        <span class="badge bg-secondary badge-tap">No</span>
                      {% endif %}
                    </div>
                  </div>

                  <div class="mobile-grid-row">
                    <div class="mobile-grid-label">Status</div>
                    <div class="mobile-grid-value">
                      {% if is_active %}
                        <span class="badge bg-success badge-tap">Active</span>
                      {% else %}
                        <span class="badge bg-danger badge-tap">Inactive</span>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>

      {% else %}
        <div class="alert alert-info mb-0">No staff records found.</div>
      {% endif %}
    </div>
  </div>
</div>

  </div>
</div>
<style>

  .mobile-grid-value a {
  display: inline-block;
  max-width: 100%;
  word-break: break-all;       /* ✅ breaks long addresses like user@example.com */
  overflow-wrap: anywhere;     /* modern browser support for wrapping long words */
  white-space: normal;         /* ensures wrapping instead of single-line overflow */
  text-decoration: none;       /* optional: cleaner look */
  color: #0d6efd;              /* Bootstrap link color */
}

  .badge-tap { display:inline-block; padding:.6rem .7rem; font-size:.9rem; border-radius:.8rem; }
  @media (max-width:575.98px){
    .mobile-grid{ display:grid; grid-auto-rows:minmax(38px,auto); row-gap:.25rem; }
    .mobile-grid-row{ display:grid; grid-template-columns:1fr auto; align-items:center; padding:.35rem .5rem; background:#f8f9fa; border-radius:.5rem; }
    .mobile-grid-label{ font-size:.85rem; color:#6c757d; padding-right:.75rem; }
    .mobile-grid-value{ justify-self:end; }
    .staff-name{ font-size:1.05rem; }
  }
  .badge.bg-warning.text-dark{ border:1px solid rgba(0,0,0,.15); }
</style>
{% endblock %}
