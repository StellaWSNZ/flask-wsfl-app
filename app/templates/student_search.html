{% extends "header.html" %} {% block title %}Search Students{% endblock %} {%
block content %}

<div class="container mt-5">
  <h2>Search for a Student</h2>

  <input
    type="text"
    id="search-input"
    class="form-control"
    placeholder="Type a name..."
    autocomplete="off"
  />
  <ul id="results" class="list-group mt-3"></ul>
</div>
<script>
  const searchInput = document.getElementById("search-input");
  const resultsList = document.getElementById("results");

  let debounceTimer;

  function fetchStudents(query) {
    fetch(`/students/search?q=${encodeURIComponent(query)}`)
      .then((response) => response.json())
      .then((data) => {
        resultsList.innerHTML = "";

        if (data.length === 0) {
          resultsList.innerHTML =
            '<li class="list-group-item">No students found.</li>';
          return;
        }

        data.forEach((student) => {
          const item = document.createElement("li");
          item.className = "list-group-item";
          item.innerHTML = `
            <strong>${student.FirstName} ${student.LastName}</strong>
            ${student.PreferredName ? `(${student.PreferredName})` : ""}
            <br><small>DOB: ${student.DateOfBirth}</small><br>
            <small>Ethnicity: ${student.EthnicityDesc}</small><br>
            <small>Year Level: ${student.YearLevelID} (as of term ${
            student.Term
          }, ${student.CalendarYear})</small><br>
            <small>NSN: ${student.NSN}</small>
          `;
          resultsList.appendChild(item);
        });
      })
      .catch((err) => {
        console.error("‚ùå Error fetching students:", err);
        resultsList.innerHTML =
          '<li class="list-group-item text-danger">Search failed.</li>';
      });
  }

  searchInput.addEventListener("input", () => {
    clearTimeout(debounceTimer);
    const query = searchInput.value.trim();

    if (query.length < 2) {
      resultsList.innerHTML = "";
      return;
    }

    debounceTimer = setTimeout(() => {
      fetchStudents(query);
    }, 800); // 1000ms = 1 second
  });
</script>

{% endblock %}
