{% extends "header.html" %} {% block content %}
<div class="container my-4">
  <!-- Title + Search -->
  <div class="alert alert-info alert-dismissible fade show mb-4" role="alert">
    Welcome to the Frequently Asked Questions page! We encourage you to read or
    search through these common questions. For more detailed guidance, please
    visit the
    <a
      href="{{ url_for('instructions_bp.instructions_me') }}"
      class="alert-link"
    >
      Instructions Page</a
    >. If you have a question that isn’t listed here, please submit it via the
    <a href="{{ url_for('feedback_bp.feedback') }}" class="alert-link">
      Feedback Form</a
    >.
    <button
      type="button"
      class="btn-close"
      data-bs-dismiss="alert"
      aria-label="Close"
    ></button>
  </div>

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0 text-primary">Frequently Asked Questions</h1>

    <div
      class="faq-search flex-grow-1 ms-4"
      style="margin-left: 24px; max-width: 600px"
    >
      <input
        type="text"
        id="faqSearch"
        class="form-control"
        placeholder="Search questions..."
      />
    </div>
  </div>

  {% if faq_groups %} {% for qtype, items in faq_groups.items() %} {% set
  cat_index = loop.index0 %}

  <div class="card faq-category-card mb-3">
    <div class="card-header">
      <h2 class="h5 mb-0">{{ qtype }}</h2>
    </div>

    <div class="card-body p-0">
      <div class="accordion" id="accordion-{{ cat_index }}">
        {% for item in items %} {% set q_id = "q-" ~ cat_index ~ "-" ~
        loop.index0 %}
        <div
          class="accordion-item faq-item border-bottom"
          data-question="{{ item['Question'] }}"
          data-tags="{{ item['Tags'] or '' }}"
        >
          <h2 class="accordion-header" id="heading-{{ q_id }}">
            <button
              class="accordion-button collapsed faq-question-btn d-flex align-items-center"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#collapse-{{ q_id }}"
              aria-expanded="false"
              aria-controls="collapse-{{ q_id }}"
            >
              <span class="faq-arrow me-2" aria-hidden="true">➤</span>
              <span>{{ item["Question"] }}</span>
            </button>
          </h2>
          <div
            id="collapse-{{ q_id }}"
            class="accordion-collapse collapse"
            aria-labelledby="heading-{{ q_id }}"
            data-bs-parent="#accordion-{{ cat_index }}"
          >
            <div class="accordion-body">
              {{ item["Answer"] | safe }} {# TAG BADGES (robust to NaN/None) #}
              {% set tags_value = item["Tags"] %} {% if tags_value is not none
              and tags_value != "" %} {% set tags_str = tags_value | string %}
              {% if tags_str and tags_str|lower != 'nan' %}
              <div class="mt-3">
                {% for tag in tags_str.split(",") %} {% set clean_tag =
                tag.strip() %} {% if clean_tag %}
                <span class="badge bg-light me-1"> {{ clean_tag }} </span>
                {% endif %} {% endfor %}
              </div>
              {% endif %} {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endfor %} {% else %}
  <p>No FAQs available yet.</p>
  {% endif %}
</div>

<style>
  .faq-category-card .card-header {
    background-color: #004080;
    color: #ffffff;
  }

  .faq-category-card .card-header h2 {
    font-weight: 600;
  }

  /* Make light badges use dark blue text */
  .badge.bg-light {
    color: #003366 !important; /* dark blue */
    border: 1px solid #003366; /* optional: keeps them looking tidy */
    font-weight: 500;
  }

  .faq-question-btn {
    background-color: transparent;
    text-decoration: none;
    color: inherit;
  }

  .faq-question-btn:hover {
    text-decoration: none;
  }

  .accordion-button:not(.collapsed) {
    background-color: #f0f7ff;
  }

  .faq-arrow {
    font-size: 0.9rem;
    color: #004080;
    transition: transform 0.2s ease;
  }

  .faq-question-btn[aria-expanded="true"] .faq-arrow {
    transform: rotate(90deg);
  }

  /* Slight extra padding on answer text, including right side */
  .accordion-body {
    padding-right: 1.5rem;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("faqSearch");
    if (!searchInput) return;

    searchInput.addEventListener("input", function () {
      const term = this.value.trim().toLowerCase();
      const categoryCards = document.querySelectorAll(".faq-category-card");

      categoryCards.forEach((card) => {
        const items = card.querySelectorAll(".faq-item");
        let anyVisible = false;

        items.forEach((item) => {
          const q = (item.dataset.question || "").toLowerCase();
          const tags = (item.dataset.tags || "").toLowerCase();
          const combined = q + " " + tags;

          const match = !term || combined.includes(term);
          item.classList.toggle("d-none", !match);
          if (match) {
            anyVisible = true;
          }
        });

        card.classList.toggle("d-none", !anyVisible);
      });
    });
  });
</script>
{% endblock %}
